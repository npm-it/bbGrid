<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head ata-template-set="html5-reset">

	<meta charset="utf-8">
	
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>bbGrid Examples from NPM Version</title>
	
	<link rel="stylesheet" href="includes/css/bootstrap.min.css" />
	<link rel="stylesheet" href="../bbGrid.css" />
		
	<!-- Grab Google CDN's jQuery. fall back to local if necessary -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>window.jQuery || document.write("<script src='includes/js/jquery-1.9.1.min.js'>\x3C/script>")</script>
	<script src="includes/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="includes/js/underscore-min.js" type="text/javascript"></script>
	<script src="includes/js/backbone-min.js" type="text/javascript"></script>
	<script src="../bbGrid.js" type="text/javascript"></script>
	<style type="text/css">
		.wrapper { width: 960px; margin: 10px auto; }
	</style>
</head>

<body>

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header>
		
		<h1><a href="">bbGrid Examples</a></h1>
			
	</header>
	
	<article class="row">
		
		<h1>Data Grid 1</h1>
		
		<p>This example is a basic grid that has the following features:</p>
		<ul>
			<li>Default sort</li>
			<li>Custom display (via actions)</li>
			<li>Custom Sorting</li>
			<li>Custom Filter options</li>
			<li>Custom Filter column</li>
			<li>Custom Search</li>
		</ul>				
		<div id="example-1" class="span12"></div>
	
	</article>
	
	
	<footer>
		
		<p><small>&copy; 2013 Copyright North Point Ministries, Inc . All Rights Reserved.</small></p>
		
	</footer>

</div>

<script>
// sample data from http://www.briandunning.com/sample-data/
var peopleJSON = (function () {
    var json = null;
    $.ajax({
        'async': false,
        'global': false,
        'url': 'includes/js/sample.json',
        'dataType': "json",
        'success': function (data) {
            json = data;
        }
    });
    return json;
})(); 

var NPM = NPM || {};

NPM.personCollection = new Backbone.Collection(peopleJSON);

var states = _.uniq ( NPM.personCollection.pluck('State').sort() );

console.info( states  );
$(document).ready(function(){
	var personGrid = new bbGrid.View({
		container: $('#example-1'),
		collection: NPM.personCollection,
		rows: 50,
		rowList: [10,20,50,100],
		enableSearch: true,
		colModel: [
			{ name: 'FirstName', title: 'First Name', index: true },
			{ name: 'LastName', title: 'Last Name', index: true, sortOrder: 'asc' },
			{ name: 'Company', title: 'Company', index: true  },
			{ name: 'City', title: 'Location', index: true, 
				filter: true,  
				filterColName: 'State', // could also provide a customFilter function
				filterOptions: states,
				sorttype: function(model) { 
					return model.get('City');
				},
				customSearch: function(model,match) { // need to match on city or state
					if (!match || match.length == 0) return false;
					var city = model.get('City').toLowerCase();
					var state = model.get('State').toLowerCase();
					// this performs a starts with function
					return (city.lastIndexOf(match.toLowerCase(), 0) === 0 || state.lastIndexOf(match.toLowerCase(), 0) === 0); 
				},
				actions: function(id, attrs, view) {
					return attrs.City + ", " + attrs.State;
				}
			},
			{ name: 'ZIP', title: 'Zip Code', index: true, sorttype: 'number', searchable: false },
			{ name: 'Web', title: 'Web Site', index: true, searchable: false,
				actions: function(id, attrs, view) { 
					
					if (attrs.Web) return '<a href="' + attrs.Web + '" target="_blank">'+ attrs.Web.trim().replace(/^http(s)?:\/\/(www.)?(.*)(\/$)?/gi,"$3")+'</a>'; 
				} 

			}
		],
	});
	
});

</script>
  
</body>
</html>